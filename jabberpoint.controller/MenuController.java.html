<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MenuController.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JabberPoint</a> &gt; <a href="index.source.html" class="el_package">jabberpoint.controller</a> &gt; <span class="el_source">MenuController.java</span></div><h1>MenuController.java</h1><pre class="source lang-java linenums">package jabberpoint.controller;

import java.awt.MenuBar;
import java.awt.Menu;
import java.awt.MenuItem;
import java.awt.MenuShortcut;
import java.awt.event.ActionListener;
import java.util.HashMap;
import java.util.Map;

import jabberpoint.command.Command;
import jabberpoint.command.context.CommandContext;
import jabberpoint.constants.Constants;

/**
 * Controller for the menu system in JabberPoint.
 * Uses command pattern with dynamic instantiation to respect SRP and OCP.
 */
public class MenuController extends MenuBar {

	private static final long serialVersionUID = 227L;

	private final CommandContext commandContext;
	private final Map&lt;String, Class&lt;? extends Command&gt;&gt; commandBindings;

<span class="nc" id="L26">	public MenuController(CommandContext commandContext) {</span>
<span class="nc" id="L27">		this.commandContext = commandContext;</span>
<span class="nc" id="L28">		this.commandBindings = new HashMap&lt;&gt;();</span>
<span class="nc" id="L29">	}</span>

	/**
	 * Registers a menu item label with a corresponding command class.
	 * @param name Menu item label
	 * @param commandClass Command class to instantiate on click
	 */
	public void addMenuItem(String name, Class&lt;? extends Command&gt; commandClass) {
<span class="nc bnc" id="L37" title="All 4 branches missed.">		if (name == null || commandClass == null) {</span>
<span class="nc" id="L38">			throw new IllegalArgumentException(&quot;Menu item name and command class must not be null&quot;);</span>
		}
<span class="nc" id="L40">		commandBindings.put(name, commandClass);</span>
<span class="nc" id="L41">	}</span>

	/**
	 * Creates all top-level menus.
	 */
	public void createMenus() {
<span class="nc" id="L47">		createFileMenu();</span>
<span class="nc" id="L48">		createViewMenu();</span>
<span class="nc" id="L49">		createHelpMenu();</span>
<span class="nc" id="L50">	}</span>

	private void createFileMenu() {
<span class="nc" id="L53">		Menu fileMenu = new Menu(Constants.Commands.FILE);</span>
<span class="nc" id="L54">		fileMenu.add(mkMenuItem(Constants.Commands.OPEN));</span>
<span class="nc" id="L55">		fileMenu.add(mkMenuItem(Constants.Commands.NEW));</span>
<span class="nc" id="L56">		fileMenu.add(mkMenuItem(Constants.Commands.SAVE));</span>
<span class="nc" id="L57">		fileMenu.addSeparator();</span>
<span class="nc" id="L58">		fileMenu.add(mkMenuItem(Constants.Commands.EXIT));</span>
<span class="nc" id="L59">		add(fileMenu);</span>
<span class="nc" id="L60">	}</span>

	private void createViewMenu() {
<span class="nc" id="L63">		Menu viewMenu = new Menu(Constants.Commands.VIEW);</span>
<span class="nc" id="L64">		viewMenu.add(mkMenuItem(Constants.Commands.NEXT));</span>
<span class="nc" id="L65">		viewMenu.add(mkMenuItem(Constants.Commands.PREV));</span>
<span class="nc" id="L66">		viewMenu.add(mkMenuItem(Constants.Commands.GOTO));</span>
<span class="nc" id="L67">		add(viewMenu);</span>
<span class="nc" id="L68">	}</span>

	private void createHelpMenu() {
<span class="nc" id="L71">		Menu helpMenu = new Menu(Constants.Commands.HELP);</span>
<span class="nc" id="L72">		helpMenu.add(mkMenuItem(Constants.Commands.ABOUT));</span>
<span class="nc" id="L73">		setHelpMenu(helpMenu);</span>
<span class="nc" id="L74">	}</span>

	/**
	 * Creates a menu item with a shortcut and command action.
	 * @param name Menu item label
	 * @return MenuItem instance
	 */
	private MenuItem mkMenuItem(String name) {
<span class="nc" id="L82">		MenuItem menuItem = new MenuItem(name, new MenuShortcut(name.charAt(0)));</span>

<span class="nc" id="L84">		Class&lt;? extends Command&gt; commandClass = commandBindings.get(name);</span>
<span class="nc bnc" id="L85" title="All 2 branches missed.">		if (commandClass != null) {</span>
<span class="nc" id="L86">			menuItem.addActionListener(createActionListener(commandClass));</span>
		}

<span class="nc" id="L89">		return menuItem;</span>
	}

	/**
	 * Creates an ActionListener that instantiates and executes a new command.
	 * @param commandClass Class of the command to instantiate
	 * @return ActionListener for menu item
	 */
	private ActionListener createActionListener(Class&lt;? extends Command&gt; commandClass) {
<span class="nc" id="L98">		return e -&gt; {</span>
			try {
<span class="nc" id="L100">				Command command = commandClass.getDeclaredConstructor().newInstance();</span>
<span class="nc" id="L101">				command.execute(commandContext);</span>
<span class="nc" id="L102">			} catch (Exception ex) {</span>
<span class="nc" id="L103">				ex.printStackTrace(); // Consider a DialogService for real error handling</span>
<span class="nc" id="L104">			}</span>
<span class="nc" id="L105">		};</span>
	}
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>